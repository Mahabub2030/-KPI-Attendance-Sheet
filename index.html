<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Attendance Sheet Month of - April 2025</title>
    <!-- <title>Attendance Sheet  Month of - <span id="currentMonthHeader"></span></title> -->
    <link rel="stylesheet" href="./data table/css/bootstrap.min.css" />
    <link rel="stylesheet" href="./data table/css/style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/daisyui@4.8.0/dist/full.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <link rel="icon" href="./img/logo.jpg" />
  </head>

  <body>
    <div class="overflow-auto p- my-3">
      <div class="row mb-3">
        <div class="col-md-4">
          <select id="month-select" class="form-select">
            <option value="2025-01">January</option>
            <option value="2025-02">February</option>
            <option value="2025-03">March</option>
            <option value="2025-04" selected>April</option>
            <option value="2025-05">May</option>
            <option value="2025-06">June</option>
            <option value="2025-07">July</option>
            <option value="2025-08">August</option>
            <option value="2025-09">September</option>
            <option value="2025-10">October</option>
            <option value="2025-11">November</option>
            <option value="2025-12">December</option>
          </select>
        </div>
        <div class="col-md-2">
          <button id="update-month" class="btn btn-primary">
            Update Month
          </button>
        </div>
        <div class="col-md-2">
          <button id="download-pdf" class="btn btn-success">
            Download PDF
          </button>
        </div>
      </div>
      <div class="border-warning-subtle grid grid-flow-row-dense rounded-3xl">
        <div class="row">
          <div class="col">
            <div class="data_table">
              <table id="example" class="table-hover table">
                <thead class="table-dark">
                  <!-- Headers will be dynamically generated -->
                </thead>
                <tbody>
                  <!-- Data will be dynamically generated -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="./data table/js/bootsrap.bundle.min.js"></script>
    <script src="./data table/js/jquery-3.6.0.min.js"></script>
    <script src="./data table/js/datatables.min.js"></script>
    <script src="./data table/js/pdfmake.min.js"></script>
    <script src="./data table/js/vfs_fonts.js"></script>
    <script src="./data table/js/custom.js"></script>
    <script src="./index.js"></script>
    <script src="./script.js"></script>

    <script>
      // Function to get the number of days in a month
      function getDaysInMonth(year, month) {
        return new Date(year, month, 0).getDate();
      }

      // Function to get the name of the day
      function getDayName(dateStr) {
        const date = new Date(dateStr);
        return date.toLocaleDateString("en-US", { weekday: "short" });
      }

      // Function to update the table based on the selected month
      function updateTable(year, month) {
        const daysInMonth = getDaysInMonth(year, month);
        const startDate = new Date(year, month - 1, 5);

        // Create header rows
        let headerHTML = `
                <tr class="text-capitalize">
                    <th colspan="4" class="text-center text-bg-Info fw-bolder text-lg"></th>
                    <th colspan="${daysInMonth}" class="text-center text-bg-Info fw-bolder text-lg"><h5>${new Date(
          year,
          month - 1
        ).toLocaleString("default", { month: "long" })} ${year}</h5></th>
                </tr>
                <tr class="text-capitalize">
                    <th class="text-bg-Info fw-bolder col-auto text-center text-lg"><h5>S.N</h5></th>
                    <th class="text-bg-Info fw-bolder text-center col-auto text-lg"><h5>Employee ID No.</h5></th>
                    <th class="text-bg-Info fw-bolder text-center col-auto text-lg"><h5>DACO ID No.</h5></th>
                    <th class="text-bg-success fw-bolder text-center col-4 text-lg"><h5>Employees Name</h5></th>
                    <th class="text-bg-Info fw-bolder text-center col-4 text-lg"><h5>Job Title</h5></th>
                    ${Array.from({ length: daysInMonth }, (_, i) => {
                      const day = i + 1;
                      const dateStr = `${year}-${month}-${day}`;
                      return `<th class="text-bg-Info fw-bolder text-center text-lg"><h5>${getDayName(
                        dateStr
                      )}, ${day}</h5></th>`;
                    }).join("")}
                    <th class="text-bg-Info fw-bolder text-center text-lg"><h5>Total</h5></th>
                </tr>
            `;

        // Employees data here
        const employees = [
          {
            id: "1111825723",
            Daco_Id: "DMM-04-8942",
            name: "Abdulhakim Alammar",
            jobTitle: "Project Manager",
          },
          {
            id: "2254394725",
            Daco_Id: "DMM-02-7825",
            name: "Shoeib Abou Zeid Mahmoud Awad",
            jobTitle: "Operation Manager",
          },
          {
            id: "1063800229",
            Daco_Id: "DMM-05-6347",
            name: "Eman  Alnasser",
            jobTitle: "Help Desk",
          },
          {
            id: "1008147140",
            Daco_Id: "DMM-03-3837",
            name: "Zahara",
            jobTitle: "Help Desk",
          },
          {
            id: "2420562395",
            Daco_Id: "DMM-03-1114",
            name: "Ashraf Ahmed Abdulhadi",
            jobTitle: "Project Planner",
          },
          {
            id: "2483842916",
            Daco_Id: "DMM-02-2776",
            name: "Afrazier Nassal",
            jobTitle: "QA/QC Engineer",
          },
          {
            id: "1012990964",
            Daco_Id: "DMM-06-1697",
            name: "Neezar Abdulrahim",
            jobTitle: "Data Process Opertor",
          },
          {
            id: "2334029580",
            Daco_Id: "DMM-03-2147",
            name: "Javed Fateh",
            jobTitle: "Document Controller",
          },
          {
            id: "2515496525",
            Daco_Id: "DMM-08-1462",
            name: "Mahabub Alam",
            jobTitle: "Data Process Opertor",
          },
          {
            id: "2554504510",
            Daco_Id: "0",
            name: "ABDALLA SAMIR AHMED SAYED",
            jobTitle: "Data Process Opertor",
          },
          {
            id: "2588713095",
            Daco_Id: "0",
            name: "MARK LENBER  RAMOS",
            jobTitle: "Data Process Opertor",
          },
          {
            id: "1010625711",
            Daco_Id: "DMM-04-1029",
            name: "Moneer Abdulhadi ",
            jobTitle: "HSE Supervisor",
          },
          {
            id: "1004086458",
            Daco_Id: "DMM-04-5735",
            name: "Khalid Saud Alkhaldi",
            jobTitle: "HSE Supervisor",
          },
          {
            id: "2443400342",
            Daco_Id: "DMM-02-7731",
            name: "Sher Shah",
            jobTitle: "HSE Officer",
          },
          {
            id: "1079836175",
            Daco_Id: "DMM-03-8123",
            name: "Hassan Ahmad AlZahrani",
            jobTitle: "Material Expediter",
          },
          {
            id: "2521319794",
            Daco_Id: "DMM-08-0201",
            name: "Omar Mokhtar Elsayed",
            jobTitle: "Material Expediter",
          },
          {
            id: "1003490479",
            Daco_Id: "DMM-02-4902",
            name: "SALMAN DAWOOD MUBARAK",
            jobTitle: "Buyer",
          },
          {
            id: "2539609707",
            Daco_Id: "DMM-05-2621",
            name: "KHALID MOHAMED ABDEL GADIR",
            jobTitle: "Store keepr",
          },
          {
            id: "2547721387",
            Daco_Id: "DMM-05-2621",
            name: "ASHARFUL ISLAM",
            jobTitle: "Store Helper",
          },
          {
            id: "2347102093",
            Daco_Id: "DMM-02-3885",
            name: "ANAS ELAMIN SALIH ALI",
            jobTitle: "IT  Technican",
          },
          {
            id: "2360318402",
            Daco_Id: "DMM-04-2690",
            name: "ABDULLAH TAHA",
            jobTitle: "Accountant",
          },
          {
            id: "1087109466",
            Daco_Id: "DMM-04-0856",
            name: "Ahmed Al-Dossary",
            jobTitle: "Project Admin",
          },
          {
            id: "1092119575",
            Daco_Id: "DMM-06-9972",
            name: "Muhanna",
            jobTitle: "GRO Officer",
          },
          {
            id: "1078602875",
            Daco_Id: "DMM-06-9931",
            name: "Asma Ibrahim Alrawahan",
            jobTitle: "GRO Officer",
          },
          {
            id: "1045951728",
            Daco_Id: "DMM-02-4961",
            name: "MUSTAFA DAWOOD",
            jobTitle: "Camp  Boss",
          },
          {
            id: "1093276606",
            Daco_Id: "DMM-04-9536",
            name: "Hashem Hussain Al Shakuri",
            jobTitle: "Secuirty Gurad",
          },
          {
            id: "2523147565",
            Daco_Id: "DMM-05-1999",
            name: "Muhammad Tayyeb",
            jobTitle: "Camp janitor",
          },
          {
            id: "2268090160",
            Daco_Id: "DMM-03-7350",
            name: "WASEEM CHHIMPA",
            jobTitle: "Lab technician",
          },
          {
            id: "2489191995",
            Daco_Id: "DMM-03-5987",
            name: "Mohammad Al-Amin",
            jobTitle: "Lab technician",
          },
          {
            id: "2496620507",
            Daco_Id: "0",
            name: "MOHAMMED RUHUL AMIN SARKER",
            jobTitle: "Sample Collector",
          },
          {
            id: "2393912742",
            Daco_Id: "DMM-05-4132",
            name: "Antonio Enario",
            jobTitle: "Floroculturest",
          },
          {
            id: "2182413589",
            Daco_Id: "0",
            name: "Mohd Amin Jinat",
            jobTitle: "Foreman Nursery",
          },
          {
            id: "2268207699",
            Daco_Id: "DMM-04-2135",
            name: "ARNULFO LAURON",
            jobTitle: "Foreman Nursery",
          },
          {
            id: "2495831188",
            Daco_Id: "0",
            name: "MD MAHNUDUL HASAN",
            jobTitle: "Lead Gardner Nursery",
          },
          {
            id: "2453709376",
            Daco_Id: "0",
            name: "Gobindo Fokir Chan",
            jobTitle: "Lead Gardner Nursery",
          },
          {
            id: "2237074196",
            Daco_Id: "0",
            name: "Shukur Mohd Ali",
            jobTitle: "Lead Gardner Nursery",
          },
          {
            id: "2364585261",
            Daco_Id: "0",
            name: "Firuz Tarufder Hamid",
            jobTitle: "Electrician Nursery",
          },
          // // Add more employees as needed 313 done here
        ];

        // Create body rows
        let bodyHTML = employees
          .map(
            (employee, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${employee.id}</td>
                    <td>${employee.Daco_Id}</td>
                    <td>${employee.name}</td>
                    <td>${employee.jobTitle}</td>
                    ${Array.from({ length: daysInMonth }, (_, i) => {
                      const day = i + 1;
                      const dateStr = `${year}-${month}-${day}`;
                      const dayName = getDayName(dateStr);
                      if (dayName === "Fri") {
                        return '<td contenteditable="true" style="background-color: yellow;">H</td>';
                      } else {
                        return '<td contenteditable="true">P</td>';
                      }
                    }).join("")}
                    <td contenteditable="true" class="total-cell"></td>
                </tr>
            `
          )
          .join("");

        // Update table headers and body
        $("#example thead").html(headerHTML);
        $("#example tbody").html(bodyHTML);

        // Recalculate totals initially
        calculateTotals();
      }

      // Function to calculate total P and total H
      function calculateTotals() {
        $("#example tbody tr").each(function () {
          var totalP = 0;
          var totalH = 0;

          // Iterate through each cell in the row
          $(this)
            .find("td")
            .each(function (index) {
              // Skip first four columns (S.N, Employee ID No., Employees Name, Job Title)
              if (index > 3) {
                var value = $(this).text().trim();
                // Increment totalP if the cell contains 'P'
                if (value === "P") {
                  totalP++;
                }
                // Increment totalH if the cell contains 'H'
                else if (value === "H") {
                  totalH++;
                }
              }
            });

          // Update the total cell with the calculated values
          $(this).find(".total-cell").text(`P: ${totalP}, H: ${totalH}`);
        });
      }

      // Function to generate and download PDF
      function downloadPDF() {
        const [year, month] = $("#month-select").val().split("-");
        const daysInMonth = getDaysInMonth(year, month);
        const selectedMonthName = $("#month-select option:selected").text(); // Get the selected month name

        var docDefinition = {
          content: [
            {
              text: `Attendance Sheet for ${selectedMonthName}`, // Use the selected month name
              style: "header",
              color: "blue", // Set header text color
            },
            {
              table: {
                headerRows: 1,
                body: [
                  [
                    { text: "S.N", style: "tableHeader", fillColor: "#D3D3D3" },
                    {
                      text: "Employee ID No.",
                      style: "tableHeader",
                      fillColor: "#D3D3D3",
                    },
                    {
                      text: "Employees Name",
                      style: "tableHeader",
                      fillColor: "#D3D3D3",
                    },
                    {
                      text: "Job Title",
                      style: "tableHeader",
                      fillColor: "#D3D3D3",
                    },
                    ...Array.from({ length: daysInMonth }, (_, i) => {
                      const day = i + 1;
                      const dateStr = `${$("#month-select").val()}-${day}`;
                      return {
                        text: `${getDayName(dateStr)}, ${day}`,
                        style: "tableHeader",
                        fillColor: "#D3D3D3",
                      };
                    }),
                    {
                      text: "Total",
                      style: "tableHeader",
                      fillColor: "#D3D3D3",
                    },
                  ],
                  ...$("#example tbody tr")
                    .map((index, tr) => {
                      var $tr = $(tr);
                      var row = [
                        {
                          text: $tr.find("td:eq(0)").text(),
                          style: "tableBody",
                        },
                        {
                          text: $tr.find("td:eq(1)").text(),
                          style: "tableBody",
                        },
                        {
                          text: $tr.find("td:eq(2)").text(),
                          style: "tableBody",
                        },
                        {
                          text: $tr.find("td:eq(3)").text(),
                          style: "tableBody",
                        },
                        ...$tr
                          .find("td:gt(3)")
                          .map((_, td) => ({
                            text: $(td).text(),
                            style: "tableBody",
                          }))
                          .get(),
                      ];
                      return row;
                    })
                    .get(),
                ],
              },
            },
          ],
          styles: {
            header: {
              fontSize: 15,
              bold: true,
              margin: [0, 0, 0, 10],
            },
            tableHeader: {
              bold: true,
              fontSize: 8,
              color: "black",
            },
            tableBody: {
              fontSize: 8,
            },
          },
        };

        pdfMake
          .createPdf(docDefinition)
          .download(`Attendance_Sheet_${selectedMonthName}.pdf`); // Use the selected month name in the file name
      }

      // Event listener to update the month when the button is clicked
      $("#update-month").on("click", function () {
        const [year, month] = $("#month-select").val().split("-");
        updateTable(year, month);
      });

      // Event listener to recalculate totals whenever the table is updated
      $("#example tbody").on("input", "td", function () {
        calculateTotals();
      });

      // Event listener to delete 'P' on double click
      $("#example tbody").on("dblclick", "td", function () {
        if ($(this).text().trim() === "P") {
          $(this).text("");
          calculateTotals();
        }
      });

      // Event listener to download PDF
      $("#download-pdf").on("click", function () {
        downloadPDF();
      });

      // Initialize the table with the default selected month
      const [defaultYear, defaultMonth] = $("#month-select").val().split("-");
      updateTable(defaultYear, defaultMonth);
    </script>
  </body>
</html>
